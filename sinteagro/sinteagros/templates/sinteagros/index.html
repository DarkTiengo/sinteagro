{% extends "sinteagros/base.html" %}

{% block content %}

<script>
  $(document).ready(function() {

    //js Calendario
    moment().locale('pt-br');

    // Create Calendar / Cria Calendario
$('#calendar').fullCalendar({
      header: {
        left: 'prev,next',
        center: 'title',
        right: 'month,agendaWeek,agendaDay,listMonth'
      },
      locale: "pt-br",
      editable: true,
      selectable: true,
      select: function(start,end){
        var inicio = moment(start);
        $("#note-date").empty().append(inicio.format('LL'));
        $("#date").val(inicio.format("YYYY-MM-DD"));
      }
    });


    // ##### NOTEPAD ####

    // Create Notepad / Cria agenda
    $("#note-date").append(moment().format('LL'));
    $("#date").val(moment().format("YYYY-MM-DD"));

    // Notepad icons effect / Efeito nos icones da agenda
    $(".list li").focusin(function() {
      $(this).find("a").fadeIn(1000);
    }).focusout(function(){
      $(this).find("a").fadeOut(500);
    });

    $(".new-note").click(function(){
      var note = $(this).parent().find(".input-note").val();
      var line = $(this).parent();
      $.ajax({
        url: 'ajax/set_note/',
        dataType: 'json',
        data: {
          'note': note,
          'date': $("#date").val()
        },
        method: 'post',
      }).fail(function(jq,txt,erro){
        alert("Ocorreu um erro, por favor tente novamente.");
      }).done(function(data){
        if(data.response){
          line.find(".new-note").remove().append('<a href="#" class="check-note alter-note"><i class="fa fa-check icon-note"></i></a><a href="#" class="close-note"><i class="fa fa-close icon-note"></i></a>');
          line.find("a").show();
        } else{
          alert("deu errado");
        }
      })
    });

  

  });
</script>


<div class="row">
  <div class="col-md-6">
    <div id="calendar">

    </div>
  </div>
  <div class="col-md-6">
    <div id="note">
      <form action="#" method="post" id="form-note" name="form-note">
        {% csrf_token %}
        <h4 class="top-note">Anotações</h4>
        <h5 id="note-date"></h5>
        <ul class="list">
          {% for note in notes %}
            {% if note == None %}
            <li><input class="input-note" type="text" maxlength="40" /><a href="#" class="check-note new-note"><i class="fa fa-save icon-note"></i></a></li>
            {% else %}
            <li><input class="input-note" type="text" maxlength="40" name="{{note.id}}" id="{{note.id}}" value="{{note}}" /><a href="#" class="check-note alter-note"><i class="fa fa-check icon-note"></i></a><a href="#" class="close-note"><i class="fa fa-close icon-note"></i></a></li>
            {% endif %}

          {% endfor %}
        </ul>
        <input type="hidden" name="date" id="date" value="">
      </form>
    </div>
  </div>

</div>

{% endblock content %}
